<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSync Bot - Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.5/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">TradeSync Dashboard</h1>

        <!-- Stock Data -->
        <div x-data="{ stockData: {} }" x-init="fetch('/api/stock_data')
            .then(res => {
                if (!res.ok) throw new Error('Stock API failed');
                return res.json();
            })
            .then(data => stockData = data)
            .catch(err => console.error('Stock API Error:', err))">
            <p>Current Price: <span x-text="'$' + (stockData?.price ?? 'N/A')"></span></p>
        </div>

        <!-- Recent Trades -->
        <h2 class="text-2xl font-semibold mt-6">Recent Trades</h2>
        <div x-data="{ alerts: [] }" x-init="fetch('/api/trades')
            .then(res => {
                if (!res.ok) throw new Error('Trade API failed');
                return res.json();
            })
            .then(data => alerts = data)
            .catch(err => console.error('Trade API Error:', err))">

            <template x-for="alert in alerts">
                <div class="p-4 bg-gray-800 rounded-lg mb-2">
                    <p class="font-bold text-blue-400" x-text="alert.author"></p>
                    <p x-text="alert.summary"></p>
                    <p>Price at Alert: <span x-text="'$' + (alert.price_at_alert ?? 'N/A')"></span></p>
                    <p>% Change: <span x-text="alert.percent_change ?? 'N/A'"></span></p>
                    <p>Time: <span x-text="timeAgo(alert.timestamp)"></span></p>
                </div>
            </template>
        </div>
    </div>

    <script>
        function timeAgo(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            if (isNaN(date.getTime())) return 'N/A';

            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            if (seconds < 60) return 'just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }
    </script>
</body>
</html>
